# 开机，开启实模式

## 开机，发生了啥？
#### 大致流程：  
启动BIOS -> 准备实模式下中断向量表和中断服务程序 -> 加载磁盘第一扇区指定位置上(MBR)的引导程序 -> 继续引导其他程序载入内存。

#### 相关技术背景：
>  CPU大厂Intel早年与PC主板制造商约定，开机后首先进入16位实模式，并将CS寄存器默认置为0xFFFF，IP寄存器置为0x0000，因此CS:IP指向地址0xFFFF0，这时候呢，便可以从0xFFFF0加载BIOS程序了。   
      存储在主板ROM存储器中的BIOS程序载入内存执行相应程序指令完成PC机的自检工作。对操作系统而言，它还完成了一项非常重要的事情：建立和载入中断向量表和中断服务程序到内存。

MBR中的引导程序是一个512字节的映像，由446字节的程序代码和64字节的分区表组成。最后面的两字节（约定为55AA）是标记MBR结束的记号。如果不是这个标记，那么便会继续读取其他存储设备的引导区，还是找不到的话就输错误信息到屏幕："NO ROM BASIC"，然后等着重启或关机了。  
CPU会与BIOS“联手”使用int 0x19这个中断，然后，CPU从中断向量表找到对应中断向量的位置，找到对应中断服务程序所在的内存地址，这个中断服务的功能便是加载MBR映像到内存了。  
>  **注：**记得10年前读中学的时候对这启动过程稍有些了解，问为什么MBR引导程序是512字节、为啥是int 0x19这个中断…… 直到后来才知道，因为这就是传说的“约定”，有了这个约定，操作系统厂商、BIOS厂商、CPU厂商就不会为兼容性问题而很恼火了。这点不知道是不是应该感谢牛叉的IBM和Microsoft，有空再查查这方面的史料吧。

#### 引导过程

X86体系架构的操作系统引导过程：  
1. CPU初始化  
2. BIOS自检  
3. 加载内核引导程序  
4. 内核引导程序逐步引导其他引导程序或过程：主引导、次引导、内核  



#### 参考 
[主引导记录：中断向量表](http://zh.wikipedia.org/zh/%E4%B8%BB%E5%BC%95%E5%AF%BC%E8%AE%B0%E5%BD%95)   
[中断向量表](http://baike.baidu.com/view/994002.htm) 


